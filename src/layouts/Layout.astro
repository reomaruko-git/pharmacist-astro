---
const {
  title,
  description = "薬剤師のための新しい働き方支援サービス。ママ薬剤師の復職や派遣という選択肢をご提案します。",
  bodyClass = "",
} = Astro.props;

// 正規化されたURLを取得
const currentUrl = new URL(Astro.url.pathname, "https://yakuzaisupport.com");
import "../styles/global.css";
---

<!doctype html>
<html lang="ja" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />

    <title>{title}</title>
    <meta name="description" content={description} />

    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:site_name" content="薬剤師Support.com" />
    <meta
      property="og:image"
      content="https://yakuzaisupport.com/assets/images/main.png"
    />
    <meta name="twitter:card" content="summary_large_image" />

    <script is:inline>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-T5MFTFR3");
    </script>
    <link rel="canonical" href={currentUrl.href} />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/assets/images/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/assets/images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/assets/images/favicon-16x16.png"
    />
    <link rel="manifest" href="/assets/images/site.webmanifest" />
  </head>

  <body class={"bg-slate-50 font-sans text-text " + bodyClass}>
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-T5MFTFR3"
        height="0"
        width="0"
        style="display: none; visibility: hidden"></iframe></noscript
    >
    <slot />

    <button
      id="scroll-to-top"
      aria-label="ページトップへ戻る"
      class="fixed bottom-36 right-4 md:bottom-8 z-40 bg-white/60 backdrop-blur-sm border border-gray-200 text-teal-600 rounded-full w-12 h-12 shadow-lg flex items-center justify-center transition-all duration-300 opacity-0 translate-y-10 invisible hover:bg-white hover:shadow-xl hover:scale-110 active:scale-95"
    >
      <i class="fas fa-chevron-up text-lg"></i>
    </button>

    <footer class="bg-gray-800 text-gray-400 py-12 px-4 pb-14 md:pb-12 mt-auto">
      <div
        class="max-w-4xl mx-auto flex flex-col md:flex-row justify-between items-center gap-6 text-sm"
      >
        <div>
          <a href="/" class="block hover:opacity-80 transition-opacity">
            <img
              src="/assets/images/yakusupo_logo_wh.svg"
              alt="薬剤師Support.com"
              class="h-6 md:h-8 w-auto"
            />
          </a>
          <p class="text-xs mt-2">薬剤師のための新しい働き方支援サービス</p>
        </div>
        <div class="text-center md:text-right">
          <div class="mt-4 space-x-6 text-xs font-medium">
            <a href="/" class="hover:text-white transition">ママ薬剤師派遣</a>
            <a href="/privacy" class="hover:text-white transition"
              >プライバシーポリシー</a
            >
            <a href="/company" class="hover:text-white transition">運営者情報</a
            >
          </div>
        </div>
      </div>
      <div
        class="text-center text-[10px] text-gray-600 mt-12 border-t border-gray-700 pt-8"
      >
        &copy; 2025 Yakuzaishi Support.com All Rights Reserved.
      </div>
    </footer>

    <script is:inline>
      document.addEventListener("DOMContentLoaded", () => {
        const scrollTopBtn = document.getElementById("scroll-to-top");

        if (scrollTopBtn) {
          window.addEventListener("scroll", () => {
            if (window.scrollY > 300) {
              scrollTopBtn.classList.remove(
                "opacity-0",
                "translate-y-10",
                "invisible",
              );
              scrollTopBtn.classList.add(
                "opacity-100",
                "translate-y-0",
                "visible",
              );
            } else {
              scrollTopBtn.classList.remove(
                "opacity-100",
                "translate-y-0",
                "visible",
              );
              scrollTopBtn.classList.add(
                "opacity-0",
                "translate-y-10",
                "invisible",
              );
            }
          });

          scrollTopBtn.addEventListener("click", () => {
            window.scrollTo({
              top: 0,
              behavior: "smooth",
            });
          });
        }
      });
    </script>

    <div style="display:none;">
      <img
        border="0"
        width="1"
        height="1"
        src="https://www18.a8.net/0.gif?a8mat=45KFSQ+7O95GY+31X8+5YJRM"
        alt=""
      />
      <img
        border="0"
        width="1"
        height="1"
        src="https://www11.a8.net/0.gif?a8mat=45KE8R+FXCGC2+276A+5ZMCI"
        alt=""
      />
    </div>
    <script is:inline>
      document.addEventListener("DOMContentLoaded", () => {
        // ログ：プログラムが動いているか確認
        console.log("【GCLID計測】スクリプト開始");

        // 1. GCLIDがあるか確認
        const urlParams = new URLSearchParams(window.location.search);
        const gclid = urlParams.get("gclid");

        // ログ：GCLIDの中身を表示
        console.log("【GCLID計測】取得したID:", gclid);

        if (!gclid) {
          console.log("【GCLID計測】IDがないため終了します");
          return;
        }

        // 2. リンクを探す
        const links = document.querySelectorAll("a");
        console.log("【GCLID計測】ページ内のリンク数:", links.length);

        links.forEach((link) => {
          // アフィリエイトリンクっぽいか簡易チェック（httpから始まるか）
          if (link.href && link.href.startsWith("http")) {
            try {
              const targetUrl = new URL(link.href);

              // ★パラメータ付与（A8なら 's'、レントラックスなら 'idx'）
              targetUrl.searchParams.set("s", gclid);

              link.href = targetUrl.toString();
              console.log("【GCLID計測】書き換え成功:", link.href);
            } catch (e) {
              console.error("【GCLID計測】エラー:", e);
            }
          }
        });
      });
    </script>
  </body>
</html>
